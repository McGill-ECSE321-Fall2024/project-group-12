package ca.mcgill.ecse321.group12.service;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertThrows;
import org.junit.jupiter.api.Test;
import static org.mockito.ArgumentMatchers.any;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;
import org.springframework.boot.test.context.SpringBootTest;

import ca.mcgill.ecse321.group12.exception.CustomException;
import ca.mcgill.ecse321.group12.model.Review;
import ca.mcgill.ecse321.group12.repository.ReviewRepository;

@SpringBootTest
public class ReviewServiceTests {

    @Mock
    private ReviewRepository reviewRepository;

    @InjectMocks
    private ReviewService reviewService;

    @SuppressWarnings("null")
    @Test
    public void testCreateReview() {
        // set review parameters
        int reviewId = 0; // will be autogenerated
        String reviewText = "I wish I was the one to have come up with the concept of this game! Super cool.";
        int rating = 5;
        int likeCount = 0;
        // customer? or do i not need
        // aGame? or do i not need

        // create a review
        Review review = new Review();
        review.setLikeCount(likeCount);
        review.setRating(rating);
        review.setText(reviewText);
        reivew.setId(reviewId);
        when(reviewRepository.save(any(Review.class))).thenReturn(review);

        // call the service
        Review returnedReview = reviewService.createReview(likeCount, rating, reviewText);

        // verify the result
        assertNotNull(returnedReview);
        assertEquals(reviewId, returnedReview.getId());
        assertEquals(likeCount, returnedReview.getLikeCount());
        assertEquals(rating, returnedReview.getRating());
        assertEquals(reviewText, returnedReview.getText());
        verify(reviewRepository, times(1)).save(any(Review.class));
    }

        @Test
        public void testGetReviewByValidId() {
            // set review parameters
            int reviewId = 0; // will be autogenerated
            String reviewText = "It is an ok game. The graphics are cool, but there are limited functionalities.";
            int rating = 2.4;
            int likeCount = 0;
            // customer? or do i not need
            // aGame? or do i not need
    
            // create a review
            Review review = new Review();
            review.setLikeCount(likeCount);
            review.setRating(rating);
            review.setText(reviewText);
            reivew.setId(reviewId);
          
            Review createdReview = reviewService.createReview(likeCount, rating, reviewText);
            when(reviewRepository.findReviewById(reviewId)).thenReturn(review);

            // act
            Review returnedReview = reviewService.getReviewById(reviewId);


            // verify the result
            assertNotNull(returnedReview);
            assertEquals(reviewId, createdReview.getId());
            assertEquals(likeCount, createdReview.getLikeCount());
            assertEquals(rating, createdReview.getRating());
            assertEquals(reviewText, createdReview.getText());
            verify(reviewRepository, times(1)).save(any(Review.class));
        }

        // other unit tests to implement:
        // test getReviewByInvalidId
        // test updateReviewWithValidArguments
        // test updateReviewWithInvalidLikeCount
        // test updateReviewWithInvalidRating
        // test updateReviewWithInvalidText


        //createReview(int likeCount, int rating, String text)
    }


    










}